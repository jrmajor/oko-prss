#!/usr/bin/env php
<?php

namespace Major\OkoPrss;

use NunoMaduro\Collision\Provider as Collision;
use Psl\Dict;
use Psl\File;
use Psl\Vec;

require_once __DIR__ . '/vendor/autoload.php';

(new Collision())->register();

$articles = Vec\map([
    'zelenski-o-rosyjskich-zolnierzach-rzeznicy-mordercy-gwalciciele-odessa-pod-ostrzalemdzien-40-na-zywo',
    'silne-eksplozje-rosja-atakuje-z-powietrza-odesse-dzien-39-na-zywo',
    'zelenski-ostrzega-przed-wspolpraca-z-rosjanami-gauleiterzy-moga-sie-meldowac-w-rostowie-dzien-38-na-zywo',
    'ewakuacja-zniszczonego-mariupola-ukrainskie-wojsko-robi-postepy-pod-czernihowem-dzien-37-na-zywo',
    'rosja-przygotowuje-wielka-ofensywe-w-donbasie-twierdzi-zelenski-dzien-36-na-zywo',
    'swiat-nie-wierzy-w-wycofywanie-sie-rosjan-dzien-35-na-zywo',
    'kolejna-runda-negocjacji-w-turcji-centrum-mariupola-wciaz-pod-kontrola-ukrainy-dzien-34-na-zywo',
    'podolak-rosja-nie-ma-juz-jezyka-humanizmu-tylko-bomby-i-proby-zmiecenia-ukrainy-dzien-33-na-zywo',
    'zelenski-prosi-zachod-o-dostawy-ciezkiej-broni-nie-stracimy-rakiet-strzelbami-dzien-32-na-zywo',
    'biden-spotka-sie-w-polsce-z-ukrainskimi-ministrami-dzien-31-na-zywo',
    'do-polski-przylatuje-joe-biden-ukraina-zada-uwolnienia-uprowadzonych-samorzadowcow-dzien-30-na-zywo',
    'miesiac-od-wybuchu-wojny-zelenski-wzywa-wyjdzcie-na-ulice-okazcie-wsparcie-ukrainie-dzien-29-na-zywo',
    'ukraina-wojna-dzien-28-na-zywo',
    'ukraina-odrzucila-rosyjskie-ultimatum-w-sprawie-mariupola-dzien-27-na-zywo',
    'dzis-piata-runda-rozmow-ukrainy-i-rosji-mariupol-okrazony-rosjanie-stawiaja-ultimatium-dzien-26-wojny-na-zywo',
    '130-zolnierzy-z-jednej-dywizji-odmowilo-udzialu-w-wojnie-rosja-wprowadzi-mobilizacjedzien-25-na-zywo',
    'zelenski-czas-na-spotkanie-nie-zyje-rosyjski-general-mordwiczew-dzien-24-na-zywo',
    'eksplozje-lwow-ukraina-23-dzien',
    'zelenski-rosja-stala-sie-panstwem-terrorystycznym-ukraina-dzien-22-na-zywo',
    'alarmy-bombowe-w-kijowie-jaroslaw-kaczynski-zaapelowal-o-pokojowa-misje-nato-ukraina-dzien-21-na-zywo',
    'zelenski-do-rosyjskich-zolnierzy-dlaczego-musicie-umierac-chcecie-zyc-wiemy-to-ukraina-dzien-20-na-zywo',
    'zmarla-ciezarna-ze-slynnego-zdjecia-ze-szpitala-w-mariupolu-kolejna-runda-negocjacji-pokojowychukraina-dzien-19-na-zywo',
    'rosja-sie-okopuje-i-sieje-smierc-ukraina-dzien-16-na-zywo',
    'rosja-dalej-atakuje-charkow-i-sumy-w-turcji-lawrow-spotka-sie-z-kuleba-ukraina-dzien-15-na-zywo',
    'usa-wysylaja-do-polski-rakiety-patriot-onz-juz-1207-ofiar-cywilnych-wojny-ukraina-dzien-14-na-zywo',
    'wojna-ukraina-dzien-13-na-zywo',
    'gina-dzieci-dramat-irpienia-biden-chce-zakazac-importu-ropy-z-rosji-dzien-12-na-zywo',
    'mariupol-ktory-znalismy-juz-nie-istnieje-mowi-mer-miasta-dzien-11-na-zywo',
    'mariupol-oblezony-zelenski-nato-daje-zielone-swiatlo-dla-bombardowan-dzien-10-na-zywo',
    'pozar-w-elektrowni-jadrowej-po-rosyjskim-ostrzale-kolejny-dzien-walk-w-ukrainie-dzien-9-na-zywo',
    'rosjanie-przejeli-cherson-potezne-eksplozje-w-kijowie-dzien-8-na-zywo',
    'kijow-charkow-i-cherson-pod-ostrzalem-w-przemyslu-prawicowe-bojowki-dzien-7-na-zywo',
    'dotknieta-sankcjami-rosja-z-zawzietoscia-bombarduje-miasta-na-ukrainie-dzien-6-na-zywo',
    'kijow-i-charkow-pod-kontrola-ukraincow-wartosc-rubla-spadla-o-40-proc-dzien-5-na-zywo',
    'kijow-i-charkow-sie-bronia-swift-przygotowuje-sie-do-wdrozenia-sankcji-dzien-4-na-zywo',
    'kijow-sie-broni-dzien-3-na-zywo',
    'kijow-stolica-ukrainy-pod-rosyjskim-ostrzalem-rakietowym-dzien-2-na-zywo',
    'rosja-zaatakowala-wojna-w-europie-stala-sie-faktem',
], fn (string $a) => get_source($a));

$entries = Vec\flat_map($articles, fn (string $a) => parse_entries($a));

$feed = generate_atom(Dict\take($entries, 250));
$full = generate_atom($entries);

File\write(__DIR__ . '/feed/atom.xml', $feed, File\WriteMode::TRUNCATE);
File\write(__DIR__ . '/feed/full.xml', $full, File\WriteMode::TRUNCATE);
